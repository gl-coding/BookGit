# 第4节：并发优化

## 1、基本概念

并发和并行的区别：

### 1）并行，parallel

同时做某些事，可以互不干扰的同一时刻做几件事。（解决并发的一种方法）

高速公路多个车道，车辆都在跑。**同一时刻。**

### 2）并发 concurrency

同时做某些事，一个时段内有事情要处理。（遇到的问题）

高并发，同一时刻内，有很多事情要处理。

## 2、并发的解决

### 1）队列、缓冲区

排队就是把人排成队列，先进先出，解决了资源使用的问题。

排成的队列，其实就是一个缓冲地带，就是缓冲区。

Queue模块的类queue、lifoqueue、priorityqueue。

### 2）争抢的

会有一个人占据窗口，其他人会继续争抢，可以锁定窗口，窗口不在为其他人服务，这就是锁机制。（锁的概念，排他性锁，非排他性锁）。

 

### 3）预处理

一种提前加载用户需要的数据的思路，预处理思想，缓存常用。

 

### 4）并行

日常可以通过购买更多的服务器，或者开多线程，实现并行处理，来解决并发问题。

水平扩展思想。

如果在但CPU上处理，就不是并行了。

但是多数服务都是多CPU的，服务的部署就是多机、分布式的，都是并行处理。

（串行比并行快）

### 5）提速

提高单个CPU性能，或单个服务器安装更多的CPU

这就是一种垂直扩展思想。

 

### 6）消息中间件

例如地跌站外的九曲回肠的走廊，缓冲人流。

常见的消息中间件有RabbitMQ，ActiveMQ（Apache）、RocketMQ（Apache）。

 

## 3、进程和线程

在实现了线程的操作系统中，线程是操作系统能够进行运算调度的最小单位。他包含在进程中，是进程中的实际运作单位。一个程序执行实例就是一个进程。

 

进程（process）是计算机中的程序关于某数据集合上的一次运行活动，是系统进行资源分配和调度的基本单位，是操作系统结构的基础。

（可执行，可运行的加载到内存中。程序是有一定格式的，Python解释器加载，所有进程都是有入口的。偏移多少位。主线程达不到要求，就会启用多线程。

多核。调度到不同的CPU上面去，虚拟的计算单元。）

资源争抢问题:锁，排他性锁。队列，不争抢的人排队。预加载，减少数据处理速度，提前加载到内存中。一变多。

 

 

进程和程序的关系

程序是源代码编译后的文件，而这些文件存放在磁盘上。当程序被操作系统加载到内存

中，就是进程，进程中存放着指令和数据（资源），也是线程的容器。

 

Linux进程有父进程、子进程，Windows的进程是平等关系。

 

线程，有时被称为轻量级进程，是程序执行流的最小单元，一个标准的线程由**线程****ID**，当前**指令指针（****pc****）**，**寄存器集合**和**堆栈**组成。**每个线程有自己独立的栈。**

在许多系统中，创建一个线程比创建一个进程快10-100倍。

 

进程、线程的理解

现代操作系统提出的进程的概念，每一个进程都认为自己是独占所有的计算机硬件资源。

进程就是独立的王国，进程间不可以随便的共享数据。

线程就是省份，同一个进程内的线程可以共享进程的资源，每一个线程拥有自己独立的堆栈。